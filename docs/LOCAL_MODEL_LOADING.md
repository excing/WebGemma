# 本地模型加载功能

Gemma AI 助手现在支持从设备本地直接加载模型文件，无需将文件放置在 static 目录中。

## 🚀 功能特性

- **直接文件选择**: 通过文件选择器或拖拽方式加载模型
- **实时验证**: 自动验证文件格式和大小
- **智能识别**: 自动检测模型类型（文本/多模态）
- **自定义命名**: 可为加载的模型设置自定义名称
- **错误处理**: 详细的错误提示和处理

## 📋 支持的文件格式

- `.task` - MediaPipe Task 格式（推荐）
- `.bin` - 二进制模型文件
- `.tflite` - TensorFlow Lite 格式

## 📏 文件要求

- **最大文件大小**: 10GB
- **推荐格式**: 文件名包含 "web" 的浏览器优化版本
- **多模态模型**: 文件名包含 "E2B" 或 "E4B" 的为多模态模型

## 🎯 使用方法

### 方法一：通过界面加载

1. 点击右上角的 **设置** 按钮
2. 在模型选择面板中，点击 **"从本地加载模型文件"** 按钮
3. 选择模型文件或拖拽文件到上传区域
4. （可选）设置自定义模型名称
5. 点击 **"加载模型"** 按钮

### 方法二：拖拽上传

1. 打开模型选择面板
2. 点击 **"从本地加载模型文件"**
3. 直接将模型文件拖拽到上传区域
4. 确认加载

## 🔍 模型类型自动识别

系统会根据文件名自动识别模型类型：

- **多模态模型**: 文件名包含 `e2b`、`e4b` 或 `multimodal`
- **文本模型**: 其他所有模型文件
- **Web 优化**: 文件名包含 `web` 或 `task`

## ⚠️ 注意事项

### 文件安全
- 只加载来源可信的模型文件
- 大文件加载可能需要较长时间
- 确保设备有足够的内存空间

### 性能考虑
- 大模型（>2GB）可能影响浏览器性能
- 建议在性能较好的设备上使用大模型
- 首次加载可能需要几分钟时间

### 兼容性
- 确保模型文件与 MediaPipe GenAI 兼容
- 推荐使用官方发布的 Web 优化版本
- 某些自定义模型可能不兼容

## 🛠️ 故障排除

### 常见错误

**"不支持的文件格式"**
- 检查文件扩展名是否为 .task、.bin 或 .tflite
- 确认文件未损坏

**"文件过大"**
- 检查文件大小是否超过 10GB 限制
- 尝试使用压缩版本的模型

**"模型初始化失败"**
- 确认模型文件完整且未损坏
- 检查模型是否与 MediaPipe GenAI 兼容
- 尝试重新下载模型文件

**"内存不足"**
- 关闭其他占用内存的应用
- 尝试使用更小的模型
- 重启浏览器释放内存

### 调试步骤

1. **检查浏览器控制台**: 查看详细错误信息
2. **验证文件完整性**: 确认文件下载完整
3. **测试其他模型**: 尝试加载已知可用的模型
4. **重启应用**: 刷新页面重新尝试

## 📚 推荐模型

### 轻量级模型（适合测试）
- **Gemma2-2B-IT**: ~1.2GB，快速响应
- **Gemma3-1B-IT**: ~800MB，最新轻量级

### 多模态模型（支持图片+音频）
- **Gemma-3n-E2B**: ~2.5GB，平衡性能
- **Gemma-3n-E4B**: ~4.2GB，高性能

## 🔗 模型下载链接

- [Gemma2-2B-IT](https://huggingface.co/litert-community/Gemma2-2B-IT/tree/main)
- [Gemma3-1B-IT](https://huggingface.co/litert-community/Gemma3-1B-IT/tree/main)
- [Gemma-3n-E2B](https://huggingface.co/google/gemma-3n-E2B-it-litert-lm/tree/main)
- [Gemma-3n-E4B](https://huggingface.co/google/gemma-3n-E4B-it-litert-lm/tree/main)

## 💡 最佳实践

1. **首次使用**: 建议从小模型开始测试
2. **文件管理**: 将模型文件保存在专门的文件夹中
3. **命名规范**: 使用描述性的模型名称便于识别
4. **定期清理**: 删除不再使用的大模型文件释放空间

## 🔄 与预设模型的区别

| 特性 | 预设模型 | 本地模型 |
|------|----------|----------|
| 加载方式 | 从 static 目录 | 直接从设备 |
| 文件管理 | 需要放置在项目中 | 任意位置 |
| 更新便利性 | 需要重新部署 | 即时更换 |
| 存储占用 | 占用项目空间 | 不占用项目空间 |
| 分享便利性 | 随项目分享 | 需要单独分享 |

本地模型加载功能为用户提供了更大的灵活性，可以轻松测试不同的模型而无需修改项目文件。
